2024/10/25

![[Pasted image 20241025152016.png]]
### Ethernet 封包格式：

1. **Preamble (7 bytes)**：
    
    - **目的**：Preamble 主要用於 **同步化**，確保接收方的時脈與發送方保持一致。
      它由一個固定的 7 字節位元序列組成，這個序列為 **10101010**（二進制），提供了一個週期性訊號，讓接收器能夠準備好接收實際的封包。
    - **補充**：Preamble 的長度為 7 個字節，而不是用來校正資料，而是讓接收方的時鐘進行同步。在此階段，還沒有實際的封包資訊傳送。
2. **SFD (Start Frame Delimiter, 1 byte)**：
    
    - **目的**：SFD 是在 Preamble 之後的 1 個字節，值為 **10101011**（二進制）。
      告訴接收器 Preamble 結束，並且即將開始讀取封包的實際資料。這個字節標誌著 Ethernet 封包的正式開始。
3. **DA (Destination Address, 6 bytes)**：
    
    - **目的**：DA 代表封包的目標 MAC 地址（通常為 6 個字節的長度），它指定了封包的接收者。
      這裡的 MAC 地址是全局唯一的硬體地址，用來識別網絡上的設備。
    - **補充**：
      在 unicast 傳輸中，DA 是目標設備的唯一 MAC 地址。
      
      在 broadcast 傳輸中，DA 是預設為 **FF:FF:FF:FF:FF**，所有設備都會接收此封包。
      
      而 multicast 傳輸中，DA 的第 1 個位元（最低有效位元）設為 1，這表示是一個 multicast 地址，接收者會根據是否屬於該 multicast 群組來決定是否接收該封包。
	      主機（Host）可以**透過程式控制其網路介面卡（NIC, Network Interface Card）** 加入 multicast 群組。這是通過配置網路卡的協定棧來實現的，特別是透過 **IGMP（Internet Group Management Protocol）** 來告知路由器和交換機，主機希望接收某個 multicast 群組的訊息。
4. **SA (Sender Address, 6 bytes)**：
    
    - **目的**：SA 指的是發送該封包的設備的 MAC 地址，同樣長度是 6 個字節。它表明封包是由哪個設備傳送的。
      
5. **Type (2 bytes)**：
    
    - **目的**：此欄位用於標識封包所承載的上層協議類型，常見值包括：
        - **0x0800** 代表 **IPv4**。
        - **0x86DD** 代表 **IPv6**。
        - **0x0806** 代表 **ARP**（Address Resolution Protocol）。
    
6. **Data (46-1500 bytes)**：
    
    - **目的**：這是實際的傳輸數據部分，長度可以是 46 到 1500 字節不等。如果數據少於 46 字節，則需填充（padding）至最小長度 46 字節，來滿足 Ethernet 的最小封包長度要求。
    - **補充**：Ethernet 定義了最大傳輸單位（MTU）為 1500 字節，以確保在共享媒體上公平使用頻寬，過大的封包可能會佔用過多傳輸時間，導致其他封包等待過久，從而影響效能。
7. **FCS (Frame Check Sequence, 4 bytes)**：
    
    - **目的**：FCS 使用循環冗餘檢查（CRC）來進行錯誤檢測。這個欄位是根據 DA、SA、Type 和 Data 生成的一個檢查碼，用來驗證封包在傳輸過程中是否損壞。接收方會重新計算 CRC 值並與 FCS 比較，如果不一致，則表示封包在傳輸過程中出現錯誤。
    - **補充**：FCS 只用來檢查封包的完整性，不提供任何錯誤更正功能，如果檢測到錯誤，封包會被丟棄。