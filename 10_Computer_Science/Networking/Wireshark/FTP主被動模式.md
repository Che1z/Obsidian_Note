FTP（File Transfer Protocol）在傳輸過程中有**主動模式**（Active Mode）和**被動模式**（Passive Mode）兩種連接模式。
這兩種模式的主要區別在於建立資料連線的方式，尤其是如何開啟傳輸資料的連接通道。

---

### 1. **主動模式（Active Mode）**

在主動模式下，**客戶端**會主動告知**伺服器**要使用的資料連接端口。
FTP 的工作分為兩個連接：

- **控制連接（Control Connection）**：通常使用 TCP 21 埠，客戶端通過這個連接發送命令給伺服器。
- **資料連接（Data Connection）**：用來傳送實際的數據檔案。客戶端告知伺服器可以使用的本地端口，而伺服器會開啟自己的 20 埠主動連接客戶端指定的端口來傳送資料。

**流程**：

1. 客戶端與伺服器建立控制連接（21 埠）。
2. 客戶端向伺服器發送 PORT 命令，告知可用來進行資料傳輸的端口號。
3. 伺服器從其 20 埠主動連接到客戶端指定的端口進行資料傳輸。

**優缺點**：

- **優點**：對伺服器端防火牆要求較低，因為伺服器只需要開放 21 和 20 埠即可。
- **缺點**：對客戶端有防火牆的環境不友好，因為伺服器會主動連接到客戶端的端口，客戶端必須開啟防火牆的這些端口才能接收資料。

**適用情境**：適合伺服器端在防火牆後，且客戶端防火牆無限制的情況。

---

### 2. **被動模式（Passive Mode）**

被動模式是為了解決主動模式對客戶端防火牆的要求。
這種模式下，伺服器不再主動連接客戶端，而是告訴客戶端應該連接的伺服器端口。

**流程**：

1. 客戶端與伺服器建立控制連接（21 埠）。
2. 客戶端發送 PASV 命令，請求伺服器開啟一個任意端口來準備接收資料。
3. 伺服器回應告訴客戶端要使用的端口。
4. 客戶端建立到伺服器上該指定端口的連接，用來傳輸資料。

**優缺點**：

- **優點**：客戶端不需要開放額外的端口，因為所有的連接都是由客戶端主動發起。
  這樣可以較好地通過客戶端的防火牆。
- **缺點**：伺服器端需要開放更多的端口給隨機資料連接，這樣伺服器端的防火牆設置更複雜。

**適用情境**：適合客戶端防火牆有限制、伺服器端防火牆較少限制的情況。

---

### 主被動模式的比較

| 模式   | 控制連接             | 資料連接                 | 客戶端防火牆友好 | 伺服器防火牆友好 |
| ---- | ---------------- | -------------------- | -------- | -------- |
| 主動模式 | 客戶端 -> 伺服器（21 埠） | 伺服器（20 埠） -> 客戶端指定端口 | 否        | 是        |
| 被動模式 | 客戶端 -> 伺服器（21 埠） | 客戶端 -> 伺服器指定端口       | 是        | 否        |

### 總結

- **主動模式**：伺服器連接到客戶端指定端口，適合伺服器端防火牆有限制但客戶端防火牆沒有限制的環境。
- **被動模式**：客戶端連接伺服器指定端口，適合伺服器端能靈活開放端口，但客戶端防火牆有嚴格限制的環境。