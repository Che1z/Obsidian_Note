當設備需要發送封包到不同的區域網路時，會將封包發送到預設閘道（default gateway），接下來預設閘道將透過 ARP（Address Resolution Protocol）來找到目的地的 MAC 位址，以便能夠正確傳輸封包。以下是這一過程的詳細步驟：

### 封包發送過程

1. **檢查目的地 IP 位址**：
    
    - 當一台設備（例如主機 A）需要發送資料到另一台設備（例如主機 B）時，首先會檢查目的地的 IP 位址是否在自己的子網中。
    - 如果目的地 IP 位址不在同一子網（例如，主機 B 的 IP 是 `192.168.2.10`，而主機 A 的 IP 是 `192.168.1.10`），則主機 A 不能直接將封包發送給主機 B。
2. **發送到預設閘道**：
    
    - 由於主機 A 無法直接到達主機 B，因此它會將封包發送到其預設閘道（例如路由器，假設 IP 為 `192.168.1.1`）。
    - 封包的目的地 IP 地址會是主機 B 的 IP 地址，而目的地 MAC 地址暫時設為預設閘道的 MAC 地址。
3. **使用 ARP 找到 MAC 地址**：
    
    - 當預設閘道（路由器）接收到封包後，首先會檢查它的路由表，以確定如何處理這個目的地 IP 位址（主機 B 的 IP）。
    - 如果路由器已經知道如何將封包發送到 `192.168.2.0` 網段，它會使用 ARP 協定來查找主機 B 的 MAC 地址。這會涉及到發送一個 ARP 請求到 `192.168.2.0` 網段，詢問“誰是 `192.168.2.10`？”。
4. **接收 ARP 回應**：
    
    - 主機 B 收到 ARP 請求後，會回傳其 MAC 地址作為 ARP 回應，這樣路由器就能獲得主機 B 的 MAC 地址。
5. **轉發封包**：
    
    - 一旦路由器得知主機 B 的 MAC 地址，它將封包的目的地 MAC 地址更新為主機 B 的 MAC，並將封包轉發到主機 B。

### 總結

透過這個過程，預設閘道作為不同區域網路之間的中介，能夠有效地將資料從一個網段傳送到另一個網段。ARP 在這個過程中起到了關鍵作用，幫助設備將 IP 位址解析為對應的 MAC 位址，從而實現資料的正確傳送。