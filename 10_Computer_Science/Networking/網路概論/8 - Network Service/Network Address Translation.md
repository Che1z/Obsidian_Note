Network Address Translation（NAT，網路位址轉換）是一種將<mark style="background: #FFF3A3A6;">私有 IP 位址轉換成公有 IP 位址的技術</mark>。
NAT 的主要用途是允許多台設備透過單一的公有 IP 位址訪問互聯網，同時提升內部網路的安全性。NAT 常見於家庭和企業路由器，主要作用如下：

### 1. NAT 的主要功能

- **IP 位址重用**：NAT 讓多台設備（如電腦、手機、智慧家電等）共用一個或數個公有 IP 位址，減少了對公有 IP 位址的需求。
- **隱藏內部網路結構**：內部網路的私有 IP 位址不會暴露在外部網路中，增加了一層安全性。
- **允許私有 IP 訪問互聯網**：私有 IP 位址（如 `192.168.x.x`、`10.x.x.x` 等）無法直接在互聯網上路由，因此需要經過 NAT 轉換為公有 IP 才能訪問外部網路。

### 2. NAT 的類型

NAT 有幾種類型，分別適用於不同的需求場景：

#### 1. 靜態 NAT（Static NAT）

- **用途**：將內部網路中的一個私有 IP 地址永久對應到一個固定的公有 IP 位址。
- **應用**：通常用於需要從外部訪問內部網路特定設備的情況，例如 Web 伺服器、FTP 伺服器。
- **運作方式**：靜態 NAT 設定後，外部網路可以通過特定的公有 IP 訪問內部網路中的特定設備。

#### 2. 動態 NAT（Dynamic NAT）

- **用途**：將一組內部私有 IP 位址動態對應到一組公有 IP 位址。
- **應用**：適合於有多個內部設備，但不一定同時連線到外部的場景。
- **運作方式**：每次內部設備連接到外部網路時，NAT 會分配一個未使用的公有 IP 位址；當連線斷開，該 IP 會釋放供其他設備使用。

#### 3. PAT（Port Address Translation）或稱為 NAT Overload

- **用途**：將多個私有 IP 位址對應到同一個公有 IP 位址，但使用不同的埠號來區分不同的內部連線。
- **應用**：最常見於家庭和小型企業網路，用於允許多台設備共用一個公有 IP 位址訪問互聯網。
- **運作方式**：PAT 通過修改 TCP/UDP 的埠號來區分不同的內部設備。例如，一台路由器會分配不同的埠號給每個內部設備的外部連線，當資料返回時，路由器會根據埠號將資料轉發給正確的設備。

### 3. NAT 的運作流程

以下是 PAT（最常見的 NAT 類型）的基本運作流程：

1. 當內部設備發送一個請求（如 HTTP 請求）到外部網路時，NAT 會將該設備的私有 IP 位址轉換成路由器的公有 IP 位址。
2. NAT 為此連線分配一個唯一的埠號，例如 `12345`，並建立一個對應關係記錄（NAT 表），包含內部 IP、內部埠號、公有 IP、和分配的外部埠號。
3. 請求發送到外部伺服器，伺服器的回應會傳送到路由器的公有 IP 位址和對應的埠號。
4. 路由器根據 NAT 表將回應重新導向到對應的內部 IP 和埠號，這樣內部設備就能收到回應。

### 4. 使用 NAT 的優點

- **節省 IP 位址**：NAT 允許多個內部設備共用一個或少量的公有 IP 位址，有助於減少 IPv4 位址的消耗。
- **提升安全性**：NAT 隱藏了內部網路的架構，外部網路無法直接訪問內部設備，增加了一層安全防護。
- **靈活性**：使用 NAT 可以方便地更改內部網路架構，而不影響外部網路的設定。

### 5. NAT 的限制

- **雙向通信限制**：內部網路可以主動連接到外部，但外部網路不能主動連接到內部網路設備（除非使用靜態 NAT 或進行特定的埠轉發）。
- **不適合端到端加密**：某些 VPN 或端到端加密技術可能會受到 NAT 的影響，因為 NAT 修改了 IP 位址和埠號，可能導致加密連線失敗。
- **IPv6 下不需要 NAT**：在 IPv6 網路中，由於位址空間足夠大，每個設備可以擁有唯一的公有 IP 位址，因此不需要 NAT。

### 總結

NAT 是一種位址轉換技術，用於讓內部網路的私有 IP 位址可以透過公有 IP 訪問外部網路。它主要通過修改位址或埠號來實現多台設備共用一個 IP 的功能。PAT 是最常見的 NAT 類型，能夠有效解決 IPv4 位址不足的問題，也提供了一定的安全性。