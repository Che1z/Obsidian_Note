# C# 資源管理與 IDisposable 模式

在 C# 中，適當的資源管理對於建立高效能、無內存洩漏的應用程式至關重要。本筆記將探討受控與非受控資源的差異，以及如何透過 IDisposable 模式正確管理這些資源。

## 受控資源 vs. 非受控資源

### 受控資源 (Managed Resources)

受控資源是由 .NET Common Language Runtime (CLR) 管理的資源，其生命週期由垃圾回收器自動處理。例如：

- .NET 物件實例
- 在托管堆上分配的記憶體
- 其他 .NET 物件參考

### 非受控資源 (Unmanaged Resources)

非受控資源是 .NET 垃圾回收器無法自動管理的系統資源，必須由開發者手動釋放。常見的非受控資源包括：

1. **作業系統資源**

   - 檔案句柄 (file handles)
   - 網路連接 (network connections)
   - 資料庫連接 (database connections)
   - 視窗句柄 (window handles)
   - 互斥鎖 (mutexes) 和信號量 (semaphores)

2. **外部記憶體**

   - 透過 `Marshal.AllocHGlobal` 分配的非托管記憶體
   - 透過 P/Invoke 或 COM Interop 獲取的外部記憶體
   - 大型緩衝區和本機記憶體塊

3. **外部 API 資源**

   - 通過 P/Invoke 調用的 Windows API 返回的句柄
   - COM 對象 (Component Object Model)
   - 原生 DLL 中的資源

4. **硬體資源**
   - 訪問硬體設備所獲取的連接或資源
   - 印表機、掃描儀等設備的連接

非受控資源若不適當釋放，即使相關的 .NET 物件被回收，這些資源仍會保持占用狀態，導致資源洩漏。

